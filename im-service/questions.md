# 一些问题

### 为啥“持久化的消息不主动推送消息到客户端”？

客户端消息发到IM服务器之后，IM服务器会给接收客户端发送MSG_SYNC_NOTIFY，然后让客户端再主动去拉，为啥不直接返回MSG_IM呢？

这样做的目的是严格控制消息顺序的，客户端接受到的消息顺序和服务端存储的顺序会一致。只有不持久化的消息才会即时发送到接收客户端。

### 目前是不是只有customer_client才支持消息的非持久化？

我看代码中，只有CustomClient在处理消息时才会去判断MESSAGE_FLAG_UNPERSISTENT标志，如果该标志已经设置，那么就不会调用IMS的存储服务。

只有customer_client才支持消息的非持久化！

### IM终端服务器可以不用重启直接扩缩容，但是IM与IMS和IMR的连接都是靠哈希取模来选择对应的IMS或IMR。采取什么样的方案可以不用停服扩缩容？

IMR扩缩容的话，IM必须修改对应的路由服务器地址配置，然后重启所有IM服务器。

IMS扩缩容的话，IM必须修改对应的存储服务器地址配置，然后重启所有IM服务器；同时，还必须迁移消息数据文件和消息索引文件！
